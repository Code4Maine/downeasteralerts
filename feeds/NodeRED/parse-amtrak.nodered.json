[{"id":"9890a005.676f6","type":"function","name":"firsttrain","func":"var amtrak = JSON.parse(msg.payload); \n\nvar arrayLength = amtrak.features.length;\n\n// node.alert(\"array length is \" + arrayLength);\n\nvar outputMsgs = [];\nvar timestamp = new Date() / 1000;\nvar tst = timestamp.toFixed(0);\nvar waypoint = \"\";\nvar stationblob = \"\";\nvar station = [ ];\n \nfor (var i = 0; i < arrayLength; i++) {\n\n\n    var trainname = amtrak.features[i].properties.RouteName;\n  if (trainname == \"Michigan Services\") {             \n    var trainnum = amtrak.features[i].properties.TrainNum;\n    var trainorig = amtrak.features[i].properties.OrigCode;\n    var traindest = amtrak.features[i].properties.DestCode;\n    var trainstate = amtrak.features[i].properties.TrainState;\n    var trainlon = amtrak.features[i].geometry.coordinates[0];\n    var trainlat = amtrak.features[i].geometry.coordinates[1];\n    var waypoint = amtrak.features[i].properties.EventCode ;\n/*\n    if ( typeof (amtrak.features[i].properties.EventCode) === undefined ) {\n       var waypoint = \"\";\n       } else {\n       var waypoint = amtrak.features[i].properties.EventCode.toString ;\n    };\n*/\n//    var waypoint = \"foo\";  \n\n    var eventdt = amtrak.features[i].properties.EventDT ;\n       \n    if (trainnum == 350) {\n       var stationblob = amtrak.features[i].properties.Station9 ;\n       var station = JSON.parse(stationblob);\n       var estarrcmnt = station.estarrcmnt;\n    } \n\n    if (trainnum == 354) {\n       var stationblob = amtrak.features[i].properties.Station8 ;\n       var station = JSON.parse(stationblob);\n       var estarrcmnt = station.estarrcmnt;\n    } \n    \n    if (trainnum == 356) {\n       var stationblob = amtrak.features[i].properties.Station6 ;\n       var station = JSON.parse(stationblob);\n       var estarrcmnt = station.estarrcmnt;\n    } \n  \n    var owntracks = { \"_type\": \"location\",\n                  \"lat\": String(trainlat),\n                  \"lon\": String(trainlon),\n                  \"tst\": tst,\n                  \"desc\": waypoint,\n                  \"event\": \"enter\",\n                  \"acc\": \"500\" ,\n                  \"estarrcmnt\": estarrcmnt,\n                  \"eventdt\": eventdt\n                  };\n\n      outputMsgs.push(\n       { topic: \"owntracks/amtrak-\" + \n              trainorig + \"-\" + traindest +\n              \"/\" + trainnum ,\n         payload: JSON.stringify(owntracks) }\n       );\n    } ;   \n\n};\n\n\n\n\n// outputMsgs = { topic: \"test\", payload: arrayLength };\nreturn [ outputMsgs ];\n","outputs":1,"x":259,"y":111,"z":"63bd3d68.9c42c4","wires":[["9178779b.6e8788"]]}]